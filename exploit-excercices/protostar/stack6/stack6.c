#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

void getpath()
{
  char buffer[64];
  unsigned int ret;

  //Stack Size: 104 = 0x68 bytes
  //esp
  //esp+0x1c == ebp-0x4c  [buffer Start]
  //esp+0x5c              (buffer End)
  //esp+0x5c == ebp-0xc   ret
  //esp+0x60              8 bytes padding
  //esp+0x68 == ebp       old ebp
  //ebp+4                 ret value

  printf("input path please: "); fflush(stdout);

  gets(buffer);

  ret = __builtin_return_address(0);

  //Return address must NOT start with 0xbf....
  //Addresses that start with 0xbf... belong to the stack.
  if((ret & 0xbf000000) == 0xbf000000) {
      printf("bzzzt (%p)\n", ret);
      _exit(1);
  }

  printf("got path %s\n", buffer);
}

int main(int argc, char **argv)
{

  getpath();

}
