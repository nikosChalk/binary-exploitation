#Just copy-paste this script in the (gdb) prompt

shell clear
set confirm off
kill
set disassembly-flavor intel
del breakpoints


#strcpy(a, argv[1]);
b *main+76
command $bpnum
echo Breakpoint in, strcpy(a, argv[1])\n
end

#strcpy(b, argv[2]);
b *main+100
command $bpnum
echo Breakpoint in, strcpy(b, argv[2])\n
end

#strcpy(c, argv[3]);
b *main+124
command $bpnum
echo Breakpoint in, strcpy(c, argv[3])\n
end


#free(c)
b *main+136
command $bpnum
echo Breakpoint in, free(c)\n
end

#free(b)
b *main+148
command $bpnum
echo Breakpoint in, free(b)\n
end

#free(a)
b *main+160
command $bpnum
echo Breakpoint in, free(a)\n
end


#printf("dynamite failed?\n");
b *main+172
command $bpnum
echo Breakpoint in, printf("dynamite failed?")\n
end


# ---------------------------------------------------------------- #
# ---------------------------------------------------------------- #
# ---------------------------------------------------------------- #

define hook-stop

init-if-undefined $a = *(void**)($esp+0x14)
init-if-undefined $b = *(void**)($esp+0x18)
init-if-undefined $c = *(void**)($esp+0x1c)

echo \n
p $eip
x/10i $eip

echo \n
printf "a=%p, b=%p, c=%p\n", $a, $b, $c

echo \n
echo ------------------------------ chunk 0 -----------------------------------\n
x/10wx 0x804c000
echo ------------------------------ chunk 1 -----------------------------------\n
x/10wx 0x804C028
echo ------------------------------ chunk 2 -----------------------------------\n
x/10wx 0x804C050
echo ----------------------------- wilderness ----------------------------------\n
x/10wx 0x804c078
echo ------------------------------ ----- - -----------------------------------\n

end

# ---------------------------------------------------------------- #
# ---------------------------------------------------------------- #
# ---------------------------------------------------------------- #

set confirm on
shell clear
# r AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
# r $(python /home/user/solution.py)
