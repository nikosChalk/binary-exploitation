
set confirm off
delete

file /opt/fusion/bin/level03 
set disassembly-flavor intel
set follow-fork-mode child

define hook-stop
x/5i $eip
info registers
echo ~~~ Stack ~~~\n
x/12wx $esp

echo ~~~ .bss ~~~\n
echo system_ptr__addr: 
x/1wx 0x0804be20

echo stored cmd: 
x/1s 0x0804be24
end

b *0x0804964d
commands
echo gadget0\n
end

b *0x08048bf0
commands
echo gadget1\n
end

b *0x08049b4f
commands
echo gadget2\n
end

b *0x080493fe
commands
echo gadget3\n
end

b *0x0804a933
commands
echo gadget4\n
end

b system
commands
bt
end

b *decode_string+19
commands
echo Just entered decode_string\n
end

b *decode_string+64
commands
echo Before returning from decode_string\n
end

b *handle_request+254

set confirm on

# attach 17277
